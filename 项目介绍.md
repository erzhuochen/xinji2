# 心迹 (XinJi) - AI驱动的个人心理成长服务系统
## 项目答辩介绍

---

## 一、项目概述

### 1.1 项目定位
**心迹**是一款面向普通用户的**AI驱动的个人心理成长服务系统**，通过日记记录、AI情绪分析、心理训练等功能，帮助用户更好地了解和管理自己的心理状态。

### 1.2 核心价值
- 📝 **记录心情** - 简洁优雅的日记编写体验
- 🤖 **理解情绪** - 基于大语言模型的自动情绪分析
- 📊 **洞察规律** - 可视化的情绪趋势和分布统计
- 💡 **获得支持** - 专业的AI心理建议和训练指导

### 1.3 项目规模
- **开发周期**：完整的前后端分离项目
- **代码量**：后端Java代码约5000+行，前端Vue3代码约3000+行
- **功能模块**：10个核心业务模块，60+功能点
- **技术栈**：前后端分离 + 微服务架构 + Docker容器化

---

## 二、技术架构

### 2.1 整体架构
```
┌─────────────┐
│  前端Vue3   │  ← 用户界面层
└──────┬──────┘
       │ HTTP/HTTPS
┌──────▼──────┐
│ Spring Boot │  ← 业务逻辑层
└──────┬──────┘
       │
   ┌───┴───┬──────────┬──────────┐
   │       │          │          │
┌──▼──┐ ┌─▼───┐  ┌───▼───┐  ┌───▼───┐
│MySQL│ │Mongo│  │ Redis │  │DashScope│
│     │ │ DB  │  │       │  │   AI   │
└─────┘ └─────┘  └───────┘  └────────┘
```

### 2.2 技术栈选型

#### 后端技术
- **框架**：Spring Boot 3.2 + Java 17
- **数据库**：MySQL 8.0（结构化数据）+ MongoDB 6.0（非结构化数据）
- **缓存**：Redis 7（验证码、配额、缓存）
- **安全**：Spring Security + JWT无状态认证
- **AI服务**：阿里云DashScope（通义千问大模型）
- **ORM**：MyBatis Plus 3.5.5
- **工具类**：Hutool、FastJSON2

#### 前端技术
- **框架**：Vue 3.4 + TypeScript 5
- **构建工具**：Vite 5
- **UI组件库**：Element Plus 2.4
- **图表库**：ECharts 5 + echarts-wordcloud
- **状态管理**：Pinia 2
- **路由**：Vue Router 4

#### 部署运维
- **容器化**：Docker + Docker Compose
- **Web服务器**：Nginx（前端静态资源）
- **日志**：Logback（滚动日志）

### 2.3 数据库设计

#### MySQL（关系型数据）
- `t_user` - 用户表（手机号加密存储）
- `t_diary` - 日记元数据表
- `t_order` - 订单表
- `t_payment_record` - 支付流水表
- `t_cheer_quote` - 鼓励语录表

#### MongoDB（非关系型数据）
- `diary_content` - 日记内容（加密存储）
- `analysis_result` - AI分析结果
- `weekly_report` - 周报数据

#### Redis（缓存）
- 验证码存储（5分钟过期）
- AI配额计数（每日重置）
- 周报缓存（7天过期）
- 频率限制（防刷）

---

## 三、核心功能模块

### 3.1 用户认证模块
- ✅ 手机号验证码登录/注册
- ✅ JWT Token认证（7天有效期，支持刷新）
- ✅ 用户信息管理
- ✅ 账号注销（需验证码确认）

**安全特性**：
- 手机号AES加密存储 + 哈希值查询
- 验证码频率限制（每小时5次，每天10次）
- 无状态JWT认证，支持分布式部署

### 3.2 日记管理模块
- ✅ 创建/编辑/删除日记
- ✅ 草稿功能
- ✅ 日记列表（分页、日期范围、关键词搜索）
- ✅ 日记内容AES加密存储

**数据存储**：
- 元数据存MySQL（标题、日期、情绪标签）
- 内容存MongoDB（支持大文本，加密存储）

### 3.3 AI情绪分析模块（核心功能）
- ✅ 8类情绪识别：快乐、悲伤、愤怒、恐惧、惊讶、厌恶、中性、焦虑
- ✅ 认知偏差检测：10种认知偏差模式（灾难化思维、非黑即白等）
- ✅ 关键词提取
- ✅ 风险等级评估（LOW/MEDIUM/HIGH）
- ✅ 个性化调节建议生成
- ✅ 异步分析处理（提升用户体验）

**AI配额管理**：
- 免费用户：5次/天
- Pro会员：1000次/天
- Redis实时计数，每日0点重置

### 3.4 情绪周报模块
- ✅ 情绪趋势图（ECharts折线图）
- ✅ 情绪分布图（饼图）
- ✅ 关键词云图（词云可视化）
- ✅ AI生成周报总结（结合日记全文）
- ✅ 个性化建议和行动点

**技术亮点**：
- 异步生成周报（防抖机制，1分钟内只触发一次）
- MongoDB预生成 + Redis缓存（秒开体验）
- 全文版AI总结（结合日记正文，更精准）

### 3.5 深度洞察模块（Pro专属）
- ✅ 情绪模式分析
- ✅ 认知模式分析
- ✅ 成长计划生成
- ✅ 情绪预测
- ✅ 正念练习推荐

### 3.6 AI心理咨询师模块（Pro专属）
- ✅ 基于近7天日记的上下文理解
- ✅ CBT（认知行为疗法）应用
- ✅ ACT（接纳承诺疗法）应用
- ✅ 专业心理建议生成

**技术实现**：
- 自动获取用户近7天日记（最多7篇，每篇500字）
- 构建系统提示词 + 用户提示词
- 调用通义千问API，返回专业建议

### 3.7 订单支付模块
- ✅ 创建订单（月付/季付/年付）
- ✅ 微信支付集成
- ✅ 支付回调处理
- ✅ 会员激活/续期
- ✅ 订单超时自动取消（15分钟）

### 3.8 心理训练模块
- ✅ 呼吸冥想
- ✅ 认知重构
- ✅ 情绪命名
- ✅ 感恩练习
- ✅ 小目标设定

### 3.9 定时任务模块
- ✅ 每周一生成周报
- ✅ 每日检查会员到期
- ✅ 每日重置AI配额
- ✅ 每5分钟取消超时订单

---

## 四、技术亮点与创新

### 4.1 混合数据库架构
**问题**：如何平衡结构化数据查询和灵活的非结构化数据存储？

**解决方案**：
- MySQL存储用户、订单等结构化数据（强一致性、事务支持）
- MongoDB存储日记内容、AI分析结果（灵活Schema、大文本支持）
- Redis缓存热点数据（高性能、快速响应）

**优势**：
- 各数据库发挥所长
- 数据分离，便于扩展
- 性能优化，用户体验好

### 4.2 端到端数据加密
**问题**：如何保护用户隐私数据？

**解决方案**：
- 手机号：AES加密存储 + SHA256哈希值查询
- 日记内容：AES加密存储（密钥独立管理）
- 敏感信息不落明文

**实现**：
```java
// 加密存储
user.setPhone(aesUtil.encrypt(phone));
user.setPhoneHash(PhoneUtil.hash(phone));

// 查询时使用哈希值
User user = userRepository.findByPhoneHash(phoneHash);
```

### 4.3 异步AI分析处理
**问题**：AI分析耗时较长，如何不阻塞用户？

**解决方案**：
- 提交分析请求后立即返回（状态：PROCESSING）
- 后台异步调用AI API
- 用户可轮询查询结果

**实现**：
```java
@Async
public void executeAnalysisAsync(String analysisId, String content, Diary diary) {
    // 异步处理，不阻塞主线程
    Map<String, Object> aiResult = callAiForAnalysis(content);
    // 更新分析结果
    result.setStatus("COMPLETED");
}
```

### 4.4 智能周报生成
**问题**：如何生成精准、有温度的周报总结？

**解决方案**：
- 全文版AI总结：结合日记正文（而非仅统计）
- 防抖机制：1分钟内多次保存只触发一次
- 预生成 + 缓存：MongoDB存储 + Redis缓存

**技术细节**：
- 日记全文拼接（最多6000字，每篇800字）
- 构建专业提示词（心理咨询师角色）
- JSON格式输出（summary、suggestions、actionPoints）

### 4.5 认知偏差检测
**问题**：如何帮助用户发现思维误区？

**解决方案**：
- 关键词模式匹配（10种认知偏差）
- 结合AI分析结果
- 提供专业描述和建议

**检测模式**：
- 灾难化思维："完蛋"、"毁了"
- 非黑即白："总是"、"从不"
- 过度概括："每次"、"所有人"
- 读心术："他肯定觉得"
- 等10种模式

### 4.6 JWT无状态认证
**问题**：如何支持分布式部署和水平扩展？

**解决方案**：
- JWT Token认证（无状态）
- Token包含用户ID和权限信息
- 支持Token刷新（1天内可刷新）

**优势**：
- 无需Session存储
- 支持多实例部署
- 性能好，扩展性强

---

## 五、系统设计亮点

### 5.1 分层架构设计
```
Controller层 → Service层 → Repository层 → 数据库
     ↓            ↓            ↓
  接口定义    业务逻辑    数据访问
```

### 5.2 异常处理机制
- 全局异常处理器（GlobalExceptionHandler）
- 统一响应格式（ApiResponse）
- 业务异常分类（BusinessException）

### 5.3 权限控制
- Spring Security + JWT
- 基于角色的访问控制（ROLE_FREE / ROLE_PRO）
- 路由级权限验证

### 5.4 接口限流
- 验证码发送频率限制
- 日记创建频率限制（1分钟1条）
- AI分析频率限制（配额管理）

### 5.5 数据一致性
- MySQL事务支持（@Transactional）
- 订单支付幂等性处理
- 会员状态更新原子性

---

## 六、前端设计亮点

### 6.1 响应式设计
- 移动端适配
- 侧边栏自适应（小屏幕下横向布局）
- 图表自适应（ECharts响应式）

### 6.2 用户体验优化
- 路由守卫（自动登录验证）
- 加载状态提示（NProgress进度条）
- 空状态设计
- 错误提示友好

### 6.3 数据可视化
- 情绪趋势折线图
- 情绪分布饼图
- 关键词词云图
- 日记贡献热力图

### 6.4 状态管理
- Pinia集中式状态管理
- 用户信息缓存
- 日记列表缓存

---

## 七、项目成果与特色

### 7.1 功能完整性
- ✅ 10个核心业务模块
- ✅ 60+功能点
- ✅ 完整的用户生命周期管理
- ✅ 从注册到付费的完整闭环

### 7.2 技术先进性
- ✅ 前后端分离架构
- ✅ 微服务化设计
- ✅ Docker容器化部署
- ✅ AI大模型集成
- ✅ 混合数据库架构

### 7.3 安全性
- ✅ 端到端数据加密
- ✅ JWT无状态认证
- ✅ 接口限流防护
- ✅ SQL注入防护（MyBatis参数化查询）
- ✅ XSS防护（前端转义）

### 7.4 性能优化
- ✅ Redis缓存热点数据
- ✅ 异步任务处理
- ✅ 数据库索引优化
- ✅ 分页查询优化

### 7.5 可扩展性
- ✅ 模块化设计
- ✅ 接口标准化
- ✅ 配置外部化
- ✅ 支持水平扩展

---

## 八、项目总结

### 8.1 项目价值
1. **社会价值**：降低心理健康服务门槛，让更多人获得心理支持
2. **技术价值**：探索AI在心理健康领域的应用，验证大语言模型可行性
3. **商业价值**：可持续的会员订阅模式，可扩展的产品架构

### 8.2 技术收获
- 掌握了前后端分离开发流程
- 熟悉了Spring Boot微服务架构
- 学会了AI大模型API集成
- 理解了混合数据库架构设计
- 实践了Docker容器化部署

### 8.3 未来展望
- 优化AI分析准确度
- 增加更多心理训练内容
- 探索情绪预测功能
- 建立用户社区
- 与专业心理咨询机构合作