# "心迹"心理健康服务系统 - 代码生成提示词

## 项目概述
请为"心迹"（基于人工智能的个人心理成长服务系统）生成完整的前后端代码。这是一个"互联网+心理健康"项目，提供情绪日记记录、AI情绪分析、成长轨迹可视化等功能。

## 技术栈要求

### 后端技术
- 框架：Spring Boot 3.x + Maven
- 开发工具：IntelliJ IDEA
- 数据库：
  - MySQL 8.0（结构化数据：用户账户、权限、订阅状态、日记元数据）
  - MongoDB 6.0（非结构化数据：日记正文、AI分析结果、行为日志）
- 部署环境：阿里云 ECS (Linux/CentOS)
- Web服务器：Nginx
- 安全：HTTPS、JWT认证、AES加密、WAF防护

### 前端技术
- 框架：Vue 3 + TypeScript + Pinia + Element Plus
- 构建工具：Vite
- 开发工具：VS Code
- 设计原则：简洁、温暖、低刺激，主色调为柔和蓝、灰、米白
- PWA支持：渐进式Web应用，支持离线访问核心功能

## 核心功能模块

### 1. 用户账户管理模块
**功能要求：**
- 手机号 + 短信验证码注册/登录（目前阶段前段模拟生成验证码，发送给后端）
- JWT Token认证机制
- 账号注销功能
- 用户数据导出功能（符合《个人信息保护法》）
- 会员等级管理（免费用户 vs Pro用户）

**数据库设计：**
- 用户表(MySQL)：用户ID、手机号(加密)、注册时间、会员状态、会员到期时间
- 权限表(MySQL)：功能权限配置

### 2. 情绪日记记录模块
**功能要求：**

- 文字输入（富文本编辑器）
- 日期时间记录
- 草稿保存功能

**数据库设计：**
- 日记元数据表(MySQL)：日记ID、用户ID、创建时间
- 日记内容表(MongoDB)：日记ID、正文(AES加密)

### 3. AI情绪识别与分析模块
**功能要求：**
- 调用情感分析AI模型（qwen-plus）
- 识别8类基本情绪及强度（0-1范围）
- 提取关键词
- 识别认知偏差模式（灾难化思维、非黑即白、过度概括等）
- 生成调节建议

**API接口设计：**
- POST /api/diary/analyze - 提交日记进行AI分析
- 返回数据：主导情绪、情绪强度、关键词列表、认知偏差提示、调节建议

**数据库设计：**
- AI分析结果表(MongoDB)：日记ID、情绪类型、强度值、关键词、认知偏差、建议内容、分析时间

### 4. 成长轨迹可视化模块
**功能要求：**

- 情绪周报页面
- 近7天情绪折线图（使用ECharts或类似图表库）
- 各类情绪出现频率统计
- 情绪平均强度展示
- 按周切换功能
- 免费用户：仅基础周报
- Pro用户：深度洞察报告、个性化成长计划、情绪预警、正念练习推荐

**API接口设计：**
- GET /api/report/weekly?startDate=xxx - 获取周报数据
- GET /api/report/insights - 获取深度洞察（Pro用户）



### 5. 会员订阅与支付模块

**功能要求：**

- 支持微信支付

- 三种套餐：月卡(0.029元/月)、季卡(0.078元/季)、年卡(0.288元/年)

- 订单管理(待支付、已支付、已取消、已退款)

- 支付回调验签与幂等性处理

- 自动续费(可选)

- 发票开具接口

**API接口设计：**

- POST /api/order/create - 创建订单

- POST /api/payment/wechat/notify - 微信支付回调

- GET /api/order/list - 订单列表

- POST /api/order/cancel - 取消订单

**数据库设计：**

- 订单表(MySQL)：订单ID、用户ID、套餐类型、金额、订单状态、创建时间、支付时间

- 支付流水表(MySQL)：流水号、订单ID、支付方式、交易号、支付状态

### 6. 隐私与安全模块
**功能要求：**
- 端到端加密
- 数据库字段级AES加密（日记正文）
- HTTPS强制跳转
- JWT Token过期管理
- 防重复提交
- WAF防护
- 敏感词过滤
- 数据访问、删除、导出接口（GDPR/《个人信息保护法》合规）

## 非功能性要求

### 性能指标
- 首屏加载时间 ≤ 1.5秒
- API平均响应时间 ≤ 300ms
- 支持1000+并发用户

### 安全要求
- 所有接口HTTPS加密
- JWT Token认证
- SQL注入防护
- XSS攻击防护
- CSRF Token验证
- 密码BCrypt加密存储

### 可维护性
- 前后端分离架构
- RESTful API设计
- 模块化代码结构
- 统一异常处理
- 详细日志记录
- 代码注释完整

### AI调用配置补充

**阿里云百炼平台配置：**
- 模型：qwen-plus
- API Endpoint：https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
- API Key配置：application.yml中通过环境变量注入
- 超时时间：10秒
- 失败重试：最多3次，指数退避
- 免费用户：每日5次调用限制
- Pro用户：无限调用

### 定时任务配置

**周报生成任务：**
- 执行时间：每周一凌晨2点
- 任务内容：计算上周日记数据，生成周报并存入缓存
- 使用Spring @Scheduled + Redis缓存
- 缓存过期时间：7天

**会员到期检查任务：**
- 执行时间：每日凌晨1点
- 任务内容：检查即将到期用户(3天内)，推送续费提醒


### 完整认知偏差模式列表

1. 灾难化思维 - 关键词：完蛋、毁了、再也
2. 非黑即白 - 关键词：总是、从不、永远
3. 过度概括 - 关键词：每次、所有人
4. 读心术 - 关键词：他肯定觉得、她一定认为
5. 情绪推理 - 关键词：我感觉我很失败
6. 应该句式 - 关键词：我应该、必须
7. 贴标签 - 关键词：我是个失败者、我很笨
8. 个人化 - 关键词：都是我的错
9. 心理过滤 - 关键词：只看到(负面)
10. 否定正面 - 关键词：但那不算什么

### 前端Token刷新机制

- Access Token有效期：7天
- Token过期前1天自动静默刷新
- 刷新失败跳转登录页

### 日志规范

- 使用SLF4J + Logback
- 日志级别：DEBUG(开发)、INFO(生产)、ERROR(异常)
- 敏感字段脱敏(手机号中间4位、日记内容仅记录长度)
- 日志保留：30天

## 项目结构要求

### 后端目录结构
```
xinji-backend/
├── src/main/java/com/xinji/
│   ├── controller/      # 控制器层
│   ├── service/         # 服务层
│   ├── repository/      # 数据访问层
│   ├── entity/          # 实体类
│   ├── dto/             # 数据传输对象
│   ├── config/          # 配置类
│   ├── security/        # 安全相关
│   ├── util/            # 工具类
│   └── exception/       # 异常处理
├── src/main/resources/
│   ├── application.yml  # 配置文件
│   └── mapper/          # MyBatis映射
└── pom.xml
```

### 前端目录结构
```
xinji-frontend/
├── src/
│   ├── views/           # 页面组件
│   ├── components/      # 通用组件
│   ├── api/             # API接口
│   ├── store/           # Pinia状态管理
│   ├── router/          # 路由配置
│   ├── utils/           # 工具函数
│   ├── assets/          # 静态资源
│   └── styles/          # 样式文件
├── public/
├── vite.config.ts
└── package.json
```

## 代码生成要求

### 第一步：生成后端代码
1. 用户管理相关API（注册、登录、注销）
2. 日记CRUD操作API
3. AI分析服务接口
4. 报告生成API
5. 数据库连接配置
6. JWT安全配置
7. 异常统一处理

### 第二步：生成前端代码
1. 登录/注册页面
2. 情绪日记编辑页面
3. 日记列表页面
4. 情绪卡片组件
5. 周报可视化页面
6. 用户设置页面
7. 路由守卫配置
8. API封装与调用

### 第三步：数据库脚本
1. MySQL建表SQL
2. MongoDB集合初始化
3. 初始数据插入脚本

## 特别注意事项

1. **隐私保护优先**：所有敏感数据必须加密存储
2. **用户体验**：界面简洁温暖，减少认知负担
3. **错误处理**：友好的错误提示，不暴露技术细节
4. **渐进增强**：核心功能优先，高级功能分层解锁
5. **合规性**：符合中国《个人信息保护法》和《精神卫生法》
6. **可扩展性**：为未来微服务拆分预留接口

## 输出要求

请按照以下顺序生成代码：

1. **后端核心代码**
   - Spring Boot主配置
   - 用户管理模块
   - 日记管理模块
   - AI分析服务（模拟接口）
   - 报告生成模块

2. **前端核心代码**
   - 项目基础配置
   - 登录注册页面
   - 日记编辑页面
   - 日记列表页面
   - 周报页面

3. **数据库脚本**
   - MySQL建表语句
   - MongoDB初始化

4. **部署配置**
   - Nginx配置示例

请从后端用户管理模块开始生成代码，包含完整的注释和错误处理。